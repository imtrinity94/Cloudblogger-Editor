<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cloudblogger Editor</title>
    <link rel="stylesheet" href="https://unpkg.com/@cds/core/global.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@cds/core/styles/theme.dark.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@clr/ui/clr-ui.min.css">
    <style>
        body {
            background-color: #e9ecef;
            color: #e9ecef;
            margin: 0;
            font-family: Clarity City, "Avenir Next", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Noto Sans", "Ubuntu", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header-bar {
            background-color: #21333b;
            color: #ffffff;
            padding: 12px 24px;
            font-size: 18px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #324f61;
        }
        .logo {
            width: 24px;
            height: 24px;
            margin-right: 12px;
        }
        .main-content {
            padding: 20px;
        }
        #container {
            /* width: 500px; */
            height: 300px;
            border: 1px solid #324f61;
            margin-bottom: 10px;
            background-color: #1b2a32;
            border-top: none;
            border-radius: 0 0 3px 3px;
        }

        #output {
            /* width: 90%; */
            height: 250px;
            border: 1px solid #324f61;
            padding: 10px;
            background-color: #0f171c;
            color: #49afd9;
            overflow: auto;
            font-family: Consolas, Monaco, 'Courier New', monospace;
            font-size: 14px;
        }

        #run-button {
            cursor: pointer;
            display: inline-flex;
            gap: var(--cds-global-space-5);
            align-items: center;
            place-content: center;
            border: var(--clr-btn-border-width) solid;
            border-radius: var(--clr-btn-border-radius);
            min-width: var(--cds-global-space-14);
            max-width: calc(360 * (1rem / var(--cds-global-base)));
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            text-align: center;
            text-decoration: none;
            vertical-align: middle;
            border-color: var(--clr-btn-default-border-color);
            background-color: var(--clr-btn-default-bg-color);
            color: var(--clr-btn-default-color);
            font-weight: var(--cds-alias-typography-font-weight-semibold);
            font-size: var(--cds-alias-typography-font-size-2);
            line-height: var(--cds-global-space-7);
            letter-spacing: var(--cds-global-space-1);
            text-transform: uppercase;
            height: var(--clr-btn-appearance-form-height);
            padding: var(--clr-btn-appearance-form-padding);
        }

        #run-button:hover {
            background-color: #0079ad;
            color: #ffffff;
        }

        #run-button:active {
            background-color: #0077b8;
        }
        #theme-toggle:hover {
            background-color: #0079ad !important;
            color: #ffffff !important;
        }
        #theme-toggle:active {
            background-color: #0077b8;
        }
        .timestamp {
            color: #8c9ba5;
            margin-right: 8px;
        }
        .error-message {
            color: #f54f47;
        }
        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 60px);
            overflow: hidden;
            background-color: #1b2a32;
            flex-direction: row;
        }

        .clr-vertical-nav {
            width: 200px;
            background-color: #1b2a32;
            border-right: 1px solid #324f61;
            overflow-y: auto;
            height: 100%;
            flex-shrink: 0;
        }

        .editor-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 20px;
            gap: 10px;
        }

        #container {
            flex: 1;
            border: 1px solid #324f61;
            margin-bottom: 10px;
            background-color: #1b2a32;
        }

        #output {
            height: 30vh;
            border: 1px solid #324f61;
            padding: 10px;
            background-color: #0f171c;
            color: #49afd9;
            overflow: auto;
            font-family: Consolas, Monaco, 'Courier New', monospace;
            font-size: 14px;
        }

        .right-panel {
            width: 300px;
            background-color: #1b2a32;
            border: 1px solid #324f61;
            border-radius: 3px;
            padding: 15px;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 20px;
        }

        .panel-title {
            color: #e9ecef;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #324f61;
        }

        .panel-content {
            color: #c6cdd4;
            font-size: 13px;
        }

        .tree-view {
            list-style: none;
            padding-left: 0;
            margin: 0;
        }

        .tree-item {
            padding: 4px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .tree-item:hover {
            color: #49afd9;
        }

        .tree-item::before {
            content: "‚Ä∫";
            margin-right: 5px;
            color: #8c9ba5;
        }

        .properties-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .property-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 13px;
        }

        .property-label {
            color: #8c9ba5;
        }

        .property-value {
            color: #e9ecef;
        }

        /* --- Consistent box-sizing and overflow fix for all themes --- */
        html, body, .main-container, .editor-section, #container {
            box-sizing: border-box !important;
        }
        .editor-section {
            overflow: hidden !important;
        }
        #container {
            overflow: hidden !important;
            max-width: 100%;
            max-height: 100%;
        }
        /* --- End fix --- */
    </style>
    <style id="clarity-ui-light-override" disabled>
        body[cds-theme="light"] html,
        body[cds-theme="light"] body,
        body[cds-theme="light"] .main-container {
            background: #f8f9fa !important;
        }
        body[cds-theme="light"] .header-bar {
            background: #0B1622 !important;
            color: #fff !important;
        }
        body[cds-theme="light"] .main-container > .clr-vertical-nav {
            min-height: 100vh !important;
            background: #f8f9fa !important;
        }
        body[cds-theme="light"] .clr-vertical-nav {
            background: #f8f9fa !important;
            color: #222 !important;
            border-right: 1px solid #e0e0e0 !important;
        }
        body[cds-theme="light"] .nav-link {
            color: #222 !important;
            background: transparent !important;
        }
        body[cds-theme="light"] .nav-link:hover {
            background: #e0e0e0 !important;
            color: #0077b8 !important;
        }
        body[cds-theme="light"] .nav-group-text {
            color: #444 !important;
        }
        body[cds-theme="light"] .editor-section {
            background: #fff !important;
            color: #222 !important;
        }
        /* Code tab button for light mode */
        body[cds-theme="light"] .code-tab,
        body[cds-theme="light"] .code-tab.active {
            background: #fff !important;
            color: #222 !important;
        }
        body[cds-theme="light"] .code-tab.active::after {
            background: #0077b8 !important;
        }
        /* Add more overrides as needed for other elements */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
</head>
<body cds-theme="dark">
    <div style="background:#49afd9;color:#0f171c;padding:10px 24px;font-size:15px;font-weight:500;text-align:center;letter-spacing:0.01em;display:flex;align-items:center;justify-content:center;gap:10px;">
        This page is an Aria Automation Orchestrator-like code editor with ES5.1 JavaScript support, custom logging, and simulated vRO classes for testing and learning.
        <a href="https://github.com/imtrinity94/Cloudblogger-Editor" target="_blank" style="display:inline-flex;align-items:center;color:#0f171c;text-decoration:none;" title="View on GitHub">
            <svg height="20" width="20" viewBox="0 0 16 16" version="1.1" style="fill:currentColor">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
        </a>
    </div>
    <div class="header-bar">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Cpath fill='%2349AFD9' d='M18 0C8.06 0 0 8.06 0 18s8.06 18 18 18 18-8.06 18-18S27.94 0 18 0zm0 33c-8.271 0-15-6.729-15-15S9.729 3 18 3s15 6.729 15 15-6.729 15-15 15z'/%3E%3C/svg%3E" class="logo" alt="Logo">
        Cloudblogger Editor
        <button id="theme-toggle" style="margin-left:auto;
                                        cursor: pointer;
                                        display: inline-flex;
                                        gap: var(--cds-global-space-5);
                                        align-items: center;
                                        place-content: center;
                                        border: var(--clr-btn-border-width) solid;
                                        border-radius: var(--clr-btn-border-radius);
                                        min-width: var(--cds-global-space-14);
                                        max-width: calc(360 * (1rem / var(--cds-global-base)));
                                        white-space: nowrap;
                                        text-overflow: ellipsis;
                                        overflow: hidden;
                                        text-align: center;
                                        text-decoration: none;
                                        vertical-align: middle;
                                        border-color: var(--clr-btn-default-border-color);
                                        background-color: var(--clr-btn-default-bg-color);
                                        color: var(--clr-btn-default-color);
                                        font-weight: var(--cds-alias-typography-font-weight-semibold);
                                        font-size: var(--cds-alias-typography-font-size-2);
                                        line-height: var(--cds-global-space-7);
                                        letter-spacing: var(--cds-global-space-1);
                                        text-transform: uppercase;
                                        height: var(--clr-btn-appearance-form-height);
                                        padding: var(--clr-btn-appearance-form-padding);">üåô Dark Mode</button>
    </div>
    <div class="main-container">
        <div class="clr-vertical-nav has-nav-groups">
            <div class="nav-group">
                <div class="nav-group-content">
                    <button class="nav-group-trigger" type="button">
                        <span class="nav-group-text">Available Classes</span>
                    </button>
                </div>
                <div class="nav-group-children">
                    <a class="nav-link"><span class="nav-text">System</span></a>
                    <a class="nav-link"><span class="nav-text">ByteBuffer</span></a>
                    <a class="nav-link"><span class="nav-text">MimeAttachment</span></a>
                    <a class="nav-link"><span class="nav-text">File</span></a>
                    <a class="nav-link"><span class="nav-text">Command</span></a>
                    <a class="nav-link"><span class="nav-text">URL</span></a>
                    <a class="nav-link"><span class="nav-text">ZipWriter</span></a>
                    <a class="nav-link"><span class="nav-text">Properties</span></a>
                    <a class="nav-link"><span class="nav-text">Lodash (_)</span></a>
                    <a class="nav-link"><span class="nav-text">Date</span></a>
                    <a class="nav-link"><span class="nav-text">EmailMessage</span></a>
                    <a class="nav-link"><span class="nav-text">XML</span></a>
                    <a class="nav-link"><span class="nav-text">SecureString</span></a>
                    <a class="nav-link"><span class="nav-text">RegEx</span></a>
                    <a class="nav-link"><span class="nav-text">RESTHost</span></a>
                    <a class="nav-link"><span class="nav-text">CompositeType</span></a>
                </div>
            </div>
        </div>
        <div class="editor-section">
            <div class="editor-toolbar">
                <button class="code-tab active">Code</button>
            </div>
            <div id="container"></div>
            <div class="button-container">
                <button id="run-button"><span style="font-size: 12px;">‚ñ∂</span> Run</button>
            </div>
            <div id="output">Output will appear here...</div>
        </div>
    </div>

    <link id="clarity-theme-link" rel="stylesheet" href="https://unpkg.com/@cds/core/styles/theme.dark.min.css">
    <link id="clarity-ui-link" rel="stylesheet" href="https://unpkg.com/@clr/ui/clr-ui.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs/loader.js"></script>
    <script>
        let isDarkMode = true;
        const themeToggleBtn = document.getElementById('theme-toggle');
        const clarityThemeLink = document.getElementById('clarity-theme-link');
        const clarityUIThemeLink = document.getElementById('clarity-ui-link');
        const body = document.body;
        let editor; // Will be assigned later

        function setTheme(dark) {
            if (dark) {
                clarityThemeLink.href = 'https://unpkg.com/@cds/core/styles/theme.dark.min.css';
                clarityUIThemeLink.href = 'https://unpkg.com/@clr/ui/clr-ui.min.css';
                body.setAttribute('cds-theme', 'dark');
                if (editor) monaco.editor.setTheme('vs-dark');
                themeToggleBtn.innerHTML = 'üåô Dark Mode';
            } else {
                clarityThemeLink.href = 'https://unpkg.com/@cds/core/styles/theme.light.min.css';
                clarityUIThemeLink.href = 'https://unpkg.com/@clr/ui/clr-ui-light.min.css';
                body.setAttribute('cds-theme', 'light');
                if (editor) monaco.editor.setTheme('vs');
                themeToggleBtn.innerHTML = '‚òÄÔ∏è Light Mode';
            }
        }

        themeToggleBtn.addEventListener('click', function() {
            isDarkMode = !isDarkMode;
            setTheme(isDarkMode);
        });

        require.config({
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs'
            }
        });

        require(['vs/editor/editor.main'], function() {
            // Define the System class emulation with Rhino settings
            const System = {
                _logMarker: null,
                _rhinoOptimizationLevel: -1,  // Set optimization level to -1
                _rhinoVersion: "1.7r4",       // Set Rhino version to 1.7r4

                _println(prefix, text) {
                    const outText = text ? String(text).trim() : "";
                    const timestamp = getTimestamp();
                    outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span>${prefix} ${outText}<br>`;
                    if (this._logMarker) {
                        console.log(`${prefix} {{${this._logMarker}}} ${outText}`);
                    } else {
                        console.log(`${prefix} ${outText}`);
                    }
                },

                debug(text) {
                    this._println("DEBUG", text);
                },

                error(text) {
                    this._println("ERROR", text);
                },

                log(text) {
                    this._println("INFO", text);
                },

                warn(text) {
                    this._println("WARN", text);
                },

                getRhinoVersion() {
                    return this._rhinoVersion;
                },

                getVersion() {
                    return "8.18.1";
                },

                getRhinoOptimizationLevel() {
                    return this._rhinoOptimizationLevel;
                },

                sleep(milliseconds) {
                    return new Promise(resolve => setTimeout(resolve, milliseconds));
                }
            };

            // Make System globally available
            window.System = System;

            // Define base classes and utilities
            class ByteBuffer {
                constructor(data) {
                    this.buffer = new ArrayBuffer(data ? data.length : 0);
                    this.view = new Uint8Array(this.buffer);
                    if (data) {
                        this.view.set(data);
                    }
                }

                getBytes() {
                    return Array.from(this.view);
                }

                length() {
                    return this.buffer.byteLength;
                }
            }

            class MimeAttachment {
                constructor(name, content, mimeType) {
                    this.name = name;
                    this.content = content;
                    this.mimeType = mimeType || 'application/octet-stream';
                }

                getName() {
                    return this.name;
                }

                getContent() {
                    return this.content;
                }

                getMimeType() {
                    return this.mimeType;
                }
            }

            class File {
                constructor(path) {
                    this.path = path;
                    this._content = '';
                }

                exists() {
                    return true; // Simulated
                }

                write(content) {
                    this._content = content;
                    System.log(`File written: ${this.path}`);
                }

                read() {
                    return this._content;
                }

                copy(destination) {
                    System.log(`File copied from ${this.path} to ${destination}`);
                }
            }

            class Command {
                constructor(cmd) {
                    this.cmd = cmd;
                }

                execute() {
                    System.log(`Executing command: ${this.cmd}`);
                    return 0; // Simulated success
                }

                result() {
                    return "Command executed successfully"; // Simulated result
                }
            }

            class URL {
                constructor(url) {
                    this.url = url;
                }

                getContent() {
                    return new ByteBuffer([]);
                }
            }

            class ZipWriter {
                constructor() {
                    this.entries = new Map();
                }

                write(name, content) {
                    this.entries.set(name, content);
                    System.log(`Added to zip: ${name}`);
                }

                close() {
                    System.log("Zip file closed");
                }
            }

            // Properties class (vRO key-value map)
            function Properties() {
                this._data = {};
            }
            Properties.prototype.put = function(key, value) {
                this._data[key] = value;
            };
            Properties.prototype.get = function(key) {
                return this._data.hasOwnProperty(key) ? this._data[key] : null;
            };
            Properties.prototype.keys = function() {
                return Object.keys(this._data);
            };
            Properties.prototype.remove = function(key) {
                delete this._data[key];
            };
            Properties.prototype.clear = function() {
                this._data = {};
            };
            Properties.prototype.toString = function() {
                return JSON.stringify(this._data);
            };

            // Make new classes globally available
            window.Properties = Properties;

            // Make classes globally available
            window.ByteBuffer = ByteBuffer;
            window.MimeAttachment = MimeAttachment;
            window.File = File;
            window.Command = Command;
            window.URL = URL;
            window.ZipWriter = ZipWriter;

            // --- BEGIN: EmailMessage class (vRO-like stub) ---
            function EmailMessage() {
                this.subject = '';
                this.body = '';
                this.fromAddress = '';
                this.toAddresses = [];
                this.ccAddresses = [];
                this.bccAddresses = [];
                this.attachments = [];
            }
            EmailMessage.prototype.setSubject = function(subject) {
                this.subject = subject;
            };
            EmailMessage.prototype.setBody = function(body) {
                this.body = body;
            };
            EmailMessage.prototype.setFromAddress = function(addr) {
                this.fromAddress = addr;
            };
            EmailMessage.prototype.addToAddress = function(addr) {
                this.toAddresses.push(addr);
            };
            EmailMessage.prototype.addCcAddress = function(addr) {
                this.ccAddresses.push(addr);
            };
            EmailMessage.prototype.addBccAddress = function(addr) {
                this.bccAddresses.push(addr);
            };
            EmailMessage.prototype.addMimeAttachment = function(attachment) {
                this.attachments.push(attachment);
            };
            EmailMessage.prototype.send = function() {
                System.log('Simulated sending email:');
                System.log('  From: ' + this.fromAddress);
                System.log('  To: ' + this.toAddresses.join(', '));
                System.log('  CC: ' + this.ccAddresses.join(', '));
                System.log('  BCC: ' + this.bccAddresses.join(', '));
                System.log('  Subject: ' + this.subject);
                System.log('  Body: ' + this.body);
                System.log('  Attachments: ' + this.attachments.length);
                return true;
            };
            window.EmailMessage = EmailMessage;
            // --- END: EmailMessage class ---

            // --- BEGIN: SecureString class (vRO-like stub) ---
            function SecureString(str) {
                this._value = String(str || '');
            }
            SecureString.prototype.getPlainText = function() {
                return this._value;
            };
            SecureString.prototype.toString = function() {
                return '********';
            };
            window.SecureString = SecureString;
            // --- END: SecureString class ---

            // --- BEGIN: RegEx class (vRO-like stub) ---
            function RegEx(pattern, flags) {
                this._pattern = pattern;
                this._flags = flags || '';
                this._re = new RegExp(pattern, this._flags);
            }
            RegEx.prototype.match = function(str) {
                return str.match(this._re);
            };
            RegEx.prototype.replace = function(str, replacement) {
                return str.replace(this._re, replacement);
            };
            RegEx.prototype.test = function(str) {
                return this._re.test(str);
            };
            window.RegEx = RegEx;
            // --- END: RegEx class ---

            // --- BEGIN: RESTHost and RESTResponse classes (vRO-like, real HTTP) ---
            function RESTHost(baseUrl) {
                this.baseUrl = baseUrl;
            }
            RESTHost.prototype.createRequest = function(method, path, content, headers) {
                return {
                    method: method,
                    url: this.baseUrl.replace(/\/$/, '') + path,
                    content: content || null,
                    headers: headers || {}
                };
            };
            RESTHost.prototype.executeRequest = function(request, callback) {
                var opts = {
                    method: request.method,
                    headers: request.headers || {}
                };
                if (request.content) {
                    opts.body = request.content;
                }
                fetch(request.url, opts)
                    .then(function(response) {
                        return response.text().then(function(text) {
                            var restResponse = new RESTResponse(response.status, text, response.headers);
                            if (callback) {
                                callback(restResponse);
                            } else {
                                System.log('Status: ' + restResponse.statusCode);
                                System.log('Content: ' + restResponse.contentAsString);
                            }
                        });
                    })
                    .catch(function(err) {
                        System.error('RESTHost error: ' + err);
                    });
            };
            function RESTResponse(statusCode, contentAsString, headers) {
                this.statusCode = statusCode;
                this.contentAsString = contentAsString;
                this.headers = headers;
            }
            window.RESTHost = RESTHost;
            window.RESTResponse = RESTResponse;
            // --- END: RESTHost and RESTResponse classes ---

            // --- BEGIN: CompositeType class (vRO-like stub) ---
            function CompositeType(typeName, initialValues) {
                this.typeName = typeName;
                this.values = initialValues || {};
            }
            CompositeType.prototype.get = function(key) {
                return this.values[key];
            };
            CompositeType.prototype.set = function(key, value) {
                this.values[key] = value;
            };
            CompositeType.prototype.keys = function() {
                var arr = [];
                for (var k in this.values) {
                    if (this.values.hasOwnProperty(k)) arr.push(k);
                }
                return arr;
            };
            CompositeType.prototype.toString = function() {
                return '[CompositeType ' + this.typeName + '] ' + JSON.stringify(this.values);
            };
            window.CompositeType = CompositeType;
            // --- END: CompositeType class ---

            // --- BEGIN: Sidebar class click handler ---
            // Mapping of class names to sample code
            var classSamples = {
                'System':
`// System class sample\nSystem.log('Hello from System!');\nSystem.debug('Debug message');\nSystem.warn('Warning message');\nSystem.error('Error message');`,
                'ByteBuffer':
`// ByteBuffer sample\nvar buffer = new ByteBuffer([65, 66, 67]); // A, B, C\nSystem.log('Buffer length: ' + buffer.length());\nSystem.log('Buffer bytes: ' + buffer.getBytes());`,
                'MimeAttachment':
`// MimeAttachment sample\nvar attachment = new MimeAttachment('file.txt', 'Sample content', 'text/plain');\nSystem.log('Attachment name: ' + attachment.getName());\nSystem.log('Attachment mime type: ' + attachment.getMimeType());`,
                'File':
`// File class sample\nvar file = new File('/tmp/test.txt');\nfile.write('Hello File!');\nSystem.log('File exists: ' + file.exists());\nSystem.log('File content: ' + file.read());`,
                'Command':
`// Command class sample\nvar cmd = new Command('echo Hello');\ncmd.execute();\nSystem.log('Command result: ' + cmd.result());`,
                'URL':
`// URL class sample\nvar url = new URL('https://example.com');\nvar content = url.getContent();\nSystem.log('URL content length: ' + content.length());`,
                'ZipWriter':
`// ZipWriter sample\nvar zip = new ZipWriter();\nzip.write('file1.txt', 'Content 1');\nzip.write('file2.txt', 'Content 2');\nzip.close();`,
                'Properties':
`// Properties class sample\nvar props = new Properties();\nprops.put('key1', 'value1');\nprops.put('key2', 'value2');\nSystem.log('key1: ' + props.get('key1'));\nSystem.log('All keys: ' + props.keys());\nprops.remove('key1');\nSystem.log('After remove: ' + props.toString());`,
                'Lodash (_)':
`// Lodash sample\nvar arr = [1, 2, 2, 3, 4, 4, 5];\nvar unique = _.uniq(arr);\n\nvar users = [\n  { name: 'Alice', age: 30 },\n  { name: 'Bob', age: 25 }\n];\nvar sorted = _.sortBy(users, 'age');\nSystem.log('Sorted users: ' + JSON.stringify(sorted));`,
                'Date':
`// vRO Date class samples
var now = Date.now(); // Get current date
System.log('Current date/time: ' + now.toString());

// Date arithmetic
var futureDate = now.addDays(7)
                   .addMonths(1)
                   .addYears(1)
                   .addHours(2)
                   .addMinutes(30)
                   .addSeconds(15)
                   .addMilliseconds(500);
System.log('Future date: ' + futureDate);

// Date comparison
var comparisonResult = now.compareTo(futureDate);
System.log('Comparison result (now vs future): ' + comparisonResult); // -1

// Date formatting
System.log('Formatted date: ' + now.format('yyyy-MM-dd HH:mm:ss.SSS'));

// Date parsing
try {
    var parsedDate = Date.parse('2025-01-01');
    System.log('Parsed date: ' + parsedDate);
} catch (e) {
    System.error('Failed to parse date: ' + e.message);
}

// Date components
System.log('Year: ' + now.getFullYear());
System.log('Month: ' + (now.getMonth() + 1)); // Months are 0-based
System.log('Day: ' + now.getDate());
System.log('Hours: ' + now.getHours());
System.log('Minutes: ' + now.getMinutes());
System.log('Seconds: ' + now.getSeconds());
System.log('Milliseconds: ' + now.getMilliseconds());

// Convert to number (timestamp)
System.log('Timestamp: ' + now.toNumber());`,
                'EmailMessage':
`// EmailMessage sample\nvar email = new EmailMessage();\nemail.setFromAddress('sender@example.com');\nemail.addToAddress('recipient@example.com');\nemail.setSubject('Test Email');\nemail.setBody('This is a test email from vRO-like editor.');\nvar att = new MimeAttachment('test.txt', 'Hello World', 'text/plain');\nemail.addMimeAttachment(att);\nemail.send();`,
                'XML':
`// XML (E4X-like stub) sample\nvar xml = new XML('<root><item>Value</item></root>');\nSystem.log('XML toString: ' + xml.toString());\nSystem.log('XML root name: ' + xml.name());\nSystem.log('XML first child: ' + xml.child(0));`,
                'SecureString':
`// SecureString sample\nvar secret = new SecureString('myPassword123');\nSystem.log('SecureString toString: ' + secret.toString());\nSystem.log('Plain text: ' + secret.getPlainText());`,
                'RegEx':
`// RegEx sample\nvar regex = new RegEx('foo', 'g');\nvar str = 'foo bar foo';\nSystem.log('Match: ' + regex.match(str));\nSystem.log('Replace: ' + regex.replace(str, 'baz'));\nSystem.log('Test: ' + regex.test(str));`,
                'RESTHost':
`// RESTHost sample (CORS must be allowed by the API!)\nvar host = new RESTHost('https://jsonplaceholder.typicode.com');\nvar req = host.createRequest('GET', '/posts/1');\nhost.executeRequest(req, function(response) {\n  System.log('Status: ' + response.statusCode);\n  System.log('Content: ' + response.contentAsString);\n});\n// Note: Output will appear after the request completes.`,
                'CompositeType':
`// CompositeType sample\nvar person = new CompositeType('Person', { name: 'Alice', age: 30 });\nSystem.log('Name: ' + person.get('name'));\nperson.set('age', 31);\nSystem.log('All keys: ' + person.keys());\nSystem.log('CompositeType: ' + person.toString());`,
            };
            // Attach click listeners to sidebar class links
            var navLinks = document.querySelectorAll('.nav-link .nav-text');
            navLinks.forEach(function(link) {
                link.parentElement.addEventListener('click', function(e) {
                    var className = link.textContent.trim();
                    if (classSamples[className]) {
                        editor.setValue(classSamples[className]);
                    } else {
                        editor.setValue('// No sample available for ' + className);
                    }
                });
            });
            // --- END: Sidebar class click handler ---

            // XML (E4X-like stub) implementation
            function XML(xmlString) {
                this._xmlString = String(xmlString || '');
                // Very basic parsing for demonstration only
                var match = this._xmlString.match(/^<([\w-]+)>/);
                this._rootName = match ? match[1] : '';
                this._children = [];
                var childMatch = this._xmlString.match(/<([\w-]+)>([^<]+)<\/[\w-]+>/);
                if (childMatch) {
                    this._children.push(childMatch[2]);
                }
            }
            XML.prototype.toString = function() {
                return this._xmlString;
            };
            XML.prototype.name = function() {
                return this._rootName;
            };
            XML.prototype.child = function(idx) {
                return this._children[idx] || null;
            };
            // Make XML globally available
            window.XML = XML;

            // --- BEGIN: Enhanced vRO Date class ---
            Date.prototype.addDays = function(days) {
                var date = new Date(this.valueOf());
                date.setDate(date.getDate() + days);
                return date;
            };

            Date.prototype.addMonths = function(months) {
                var date = new Date(this.valueOf());
                date.setMonth(date.getMonth() + months);
                return date;
            };

            Date.prototype.addYears = function(years) {
                var date = new Date(this.valueOf());
                date.setFullYear(date.getFullYear() + years);
                return date;
            };

            Date.prototype.addHours = function(hours) {
                var date = new Date(this.valueOf());
                date.setHours(date.getHours() + hours);
                return date;
            };

            Date.prototype.addMinutes = function(minutes) {
                var date = new Date(this.valueOf());
                date.setMinutes(date.getMinutes() + minutes);
                return date;
            };

            Date.prototype.addSeconds = function(seconds) {
                var date = new Date(this.valueOf());
                date.setSeconds(date.getSeconds() + seconds);
                return date;
            };

            Date.prototype.addMilliseconds = function(milliseconds) {
                var date = new Date(this.valueOf());
                date.setMilliseconds(date.getMilliseconds() + milliseconds);
                return date;
            };

            Date.prototype.compareTo = function(otherDate) {
                if (!(otherDate instanceof Date)) {
                    throw new Error('Invalid argument type. Expected Date.');
                }
                var diff = this.getTime() - otherDate.getTime();
                return diff === 0 ? 0 : (diff < 0 ? -1 : 1);
            };

            Date.prototype.toString = function() {
                return this.toUTCString();
            };

            Date.prototype.toNumber = function() {
                return this.getTime();
            };

            // Static methods
            Date.now = function() {
                return new Date();
            };

            Date.parse = function(dateString) {
                var parsed = new Date(dateString);
                if (isNaN(parsed.getTime())) {
                    throw new Error('Invalid date format');
                }
                return parsed;
            };

            // Helper methods for common date operations
            Date.prototype.format = function(pattern) {
                var date = this;
                var pad = function(num) {
                    return (num < 10 ? '0' : '') + num;
                };
                
                return pattern.replace(/yyyy|MM|dd|HH|mm|ss|SSS/g, function(match) {
                    switch (match) {
                        case 'yyyy': return date.getFullYear();
                        case 'MM': return pad(date.getMonth() + 1);
                        case 'dd': return pad(date.getDate());
                        case 'HH': return pad(date.getHours());
                        case 'mm': return pad(date.getMinutes());
                        case 'ss': return pad(date.getSeconds());
                        case 'SSS': return String(date.getMilliseconds()).padStart(3, '0');
                        default: return match;
                    }
                });
            };

            // Update Date sample code
            classSamples['Date'] =
`// vRO Date class samples
var now = Date.now(); // Get current date
System.log('Current date/time: ' + now.toString());

// Date arithmetic
var futureDate = now.addDays(7)
                   .addMonths(1)
                   .addYears(1)
                   .addHours(2)
                   .addMinutes(30)
                   .addSeconds(15)
                   .addMilliseconds(500);
System.log('Future date: ' + futureDate);

// Date comparison
var comparisonResult = now.compareTo(futureDate);
System.log('Comparison result (now vs future): ' + comparisonResult); // -1

// Date formatting
System.log('Formatted date: ' + now.format('yyyy-MM-dd HH:mm:ss.SSS'));

// Date parsing
try {
    var parsedDate = Date.parse('2025-01-01');
    System.log('Parsed date: ' + parsedDate);
} catch (e) {
    System.error('Failed to parse date: ' + e.message);
}

// Date components
System.log('Year: ' + now.getFullYear());
System.log('Month: ' + (now.getMonth() + 1)); // Months are 0-based
System.log('Day: ' + now.getDate());
System.log('Hours: ' + now.getHours());
System.log('Minutes: ' + now.getMinutes());
System.log('Seconds: ' + now.getSeconds());
System.log('Milliseconds: ' + now.getMilliseconds());

// Convert to number (timestamp)
System.log('Timestamp: ' + now.toNumber());`;

            // Create single editor instance with combined example code
            editor = monaco.editor.create(document.getElementById('container'), {
                value: `// VMware Aria Automation Environment Example
System.log("Rhino Engine Version: " + System.getRhinoVersion());
System.log("Rhino Optimization Level: " + System.getRhinoOptimizationLevel());

// Test vRO Classes
var file = new File("/tmp/test.txt");
file.write("Hello World");
System.log("File content: " + file.read());

var cmd = new Command("echo Hello");
cmd.execute();
System.log("Command result: " + cmd.result());

var zip = new ZipWriter();
zip.write("test.txt", "Hello World");
zip.close();

var attachment = new MimeAttachment(
    "test.txt",
    "Hello World",
    "text/plain"
);
System.log("Attachment name: " + attachment.getName());

var buffer = new ByteBuffer([72, 101, 108, 108, 111]); // "Hello" in ASCII
System.log("Buffer length: " + buffer.length());

var url = new URL("https://example.com");
var content = url.getContent();
System.log("URL content length: " + content.length());`,
                language: 'javascript',
                theme: isDarkMode ? 'vs-dark' : 'vs',
                minimap: { enabled: false },
                fontSize: 14,
                fontFamily: "Consolas, Monaco, 'Courier New', monospace",
                lineHeight: 21,
                renderLineHighlight: 'all',
                scrollBeyondLastLine: false,
                automaticLayout: true,
                contextmenu: true,
                lineNumbers: 'on',
                roundedSelection: false,
                selectOnLineNumbers: true,
                wordWrap: 'off',
                folding: true,
                glyphMargin: true,
                renderIndentGuides: true,
                scrollBeyondLastLine: false
            });
            setTheme(isDarkMode); // Ensure theme is set on load

            // Custom console.log implementation
            const originalConsoleLog = console.log;
            const outputDiv = document.getElementById('output');

            function getTimestamp() {
                const now = new Date();
                const pad = (num) => String(num).padStart(2, '0');
                const year = now.getUTCFullYear();
                const month = pad(now.getUTCMonth() + 1);
                const day = pad(now.getUTCDate());
                const hours = pad(now.getUTCHours());
                const minutes = pad(now.getUTCMinutes());
                const seconds = pad(now.getUTCSeconds());
                const milliseconds = String(now.getUTCMilliseconds()).padStart(3, '0');
                return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds} +00:00`;
            }

            function customLog(...args) {
                const timestamp = getTimestamp();
                const output = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span>${output}<br>`;
                originalConsoleLog.apply(console, args); // Ensure logs also appear in the browser console
            }

            // Function to check for unsupported syntax based on Rhino 1.7R4 (ES5.1)
            function checkForUnsupportedSyntax(code) {
                const unsupportedFeatures = [
                    // ES6+ keywords and syntax (allow 'const' for ES5.1 basic support)
                    { pattern: /\blet\b/, message: "'let' is not supported. Use 'var' or 'const' instead (Rhino 1.7R4/ES5.1)." },
                    // { pattern: /\bconst\b/, message: "'const' is not supported. Use 'var' instead (Rhino 1.7R4/ES5.1)." },
                    { pattern: /=>\s*[{(]?/, message: "Arrow functions are not supported (Rhino 1.7R4/ES5.1). Use function expressions." },
                    { pattern: /(^|[^\w])class\s+\w+/, message: "Class syntax is not supported (Rhino 1.7R4/ES5.1). Use constructor functions.", skipInComment: true },
                    { pattern: /`[^`]*`/, message: "Template literals are not supported (Rhino 1.7R4/ES5.1). Use string concatenation." },
                    { pattern: /\.\.\./, message: "Spread/rest operator is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bimport\b|\bexport\b/, message: "ES6 modules (import/export) are not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /async\s+function|\bawait\b/, message: "Async/await is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /function\s*\*\s*\w*/, message: "Generators are not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /Object\.assign\s*\(/, message: "Object.assign is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bPromise\b/, message: "Promises are not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /for\s*each\s*\(/, message: "'for each (...)' is deprecated and no longer supported in vRO or standard JavaScript. Please use 'for (var i in ...)' or 'for (var i = 0; i < arr.length; i++)' instead." },
                    { pattern: /for\s*\(\s*\w+\s+of\s+/, message: "'for...of' loops are not supported (Rhino 1.7R4/ES5.1). Use 'for...in' or classic for loops." },
                    { pattern: /\bSymbol\b/, message: "Symbol is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bMap\b|\bSet\b|\bWeakMap\b|\bWeakSet\b/, message: "Map/Set/WeakMap/WeakSet are not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bReflect\b/, message: "Reflect is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bProxy\b/, message: "Proxy is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bBigInt\b/, message: "BigInt is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bArray\.from\b|\bArray\.of\b/, message: "Array.from/Array.of are not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bObject\.entries\b|\bObject\.values\b/, message: "Object.entries/Object.values are not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bString\.includes\b|\.includes\s*\(/, message: "String.prototype.includes is not supported (Rhino 1.7R4/ES5.1). Use indexOf instead." },
                    { pattern: /\bArray\.find\b|\.find\s*\(/, message: "Array.prototype.find is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bArray\.findIndex\b|\.findIndex\s*\(/, message: "Array.prototype.findIndex is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bObject\.getOwnPropertySymbols\b/, message: "Object.getOwnPropertySymbols is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bObject\.is\b/, message: "Object.is is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bNumber\.isNaN\b/, message: "Number.isNaN is not supported (Rhino 1.7R4/ES5.1). Use isNaN instead." },
                    { pattern: /\bNumber\.isFinite\b/, message: "Number.isFinite is not supported (Rhino 1.7R4/ES5.1). Use isFinite instead." },
                    { pattern: /\bObject\.setPrototypeOf\b/, message: "Object.setPrototypeOf is not supported (Rhino 1.7R4/ES5.1)." },
                    { pattern: /\bObject\.getPrototypeOf\b/, message: "Object.getPrototypeOf is not supported (Rhino 1.7R4/ES5.1)." },
                    // Destructuring
                    //{ pattern: /\{\s*\w+\s*\}/, message: "Object destructuring is not supported (Rhino 1.7R4/ES5.1)." },
                    // Removed array destructuring warning as it is supported in Rhino 1.7R4/ES5.1
                ];
                const errors = [];
                // Remove comments before checking for class keyword
                var codeNoComments = code.replace(/\/\*[\s\S]*?\*\//g, '').replace(/\/\/.*$/gm, '');
                unsupportedFeatures.forEach(feature => {
                    if (feature.pattern.toString().indexOf('class') !== -1) {
                        if (feature.pattern.test(codeNoComments)) {
                            errors.push(feature.message);
                        }
                    } else {
                        if (feature.pattern.test(code)) {
                            errors.push(feature.message);
                        }
                    }
                });
                return errors;
            }

            // Run button click handler
            document.getElementById('run-button').addEventListener('click', function() {
                outputDiv.innerHTML = ''; // Clear previous output
                const code = editor.getValue();

                // First check for unsupported syntax
                const syntaxErrors = checkForUnsupportedSyntax(code);
                if (syntaxErrors.length > 0) {
                    const timestamp = getTimestamp();
                    outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span><span class="error-message">vRO Rhino 1.7R4 Compatibility Errors:</span><br>`;
                    syntaxErrors.forEach(error => {
                        outputDiv.innerHTML += `<span class="timestamp"></span><span class="error-message">- ${error}</span><br>`;
                    });
                    outputDiv.innerHTML += `<span class="timestamp"></span><span class="error-message">Please modify your code to use only features supported by Rhino 1.7R4 (ES5.1).</span><br>`;
                    return;
                }

                try {
                    // Execute the code if no unsupported syntax is found
                    eval(code);
                } catch (error) {
                    const timestamp = getTimestamp();
                    outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span><span class="error-message">Runtime Error: ${error.message}</span><br>`;
                }

                if (messages && messages.length > 0) {
                    // Display ESLint errors in the output panel
                    messages.forEach((message) => {
                        const timestamp = getTimestamp();
                        outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span><span class="error-message">Error: ${message.message} (Line: ${message.line}, Column: ${message.column})</span><br>`;
                    });
                } else {
                    // Execute code if no errors
                    try {
                        console.log = customLog; // Override console.log
                        eval(code); // Execute the code
                    } catch (error) {
                        const timestamp = getTimestamp();
                        outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span><span class="error-message">Error: ${error.message}</span><br>`;
                    } finally {
                        console.log = originalConsoleLog; // Restore console.log
                    }
                }
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/eslint/8.45.0/eslint.min.js"></script>
    <script>
        const eslintConfig = {
            parserOptions: {
                ecmaVersion: 5, // Restrict to ES5
            },
            env: {
                browser: true,
                es5: true,
            },
            rules: {
                'no-arrow-functions': 'error',
                'no-template-literals': 'error',
                'no-default-parameters': 'error',
                'no-rest-parameters': 'error',
                'no-spread': 'error',
                'no-class': 'error',
                'no-let': 'error',
                'no-const': 'error',
                'no-generators': 'error',
                'no-modules': 'error',
                'no-destructuring': 'error',
            },
        };

        document.getElementById('run-button').addEventListener('click', function () {
            outputDiv.innerHTML = ''; // Clear previous output
            const code = editor.getValue();

            // Validate code with ESLint
            const linter = new eslint.Linter();
            const messages = linter.verify(code, eslintConfig);

            if (messages.length > 0) {
                // Display ESLint errors in the output panel
                messages.forEach((message) => {
                    const timestamp = getTimestamp();
                    outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span><span class="error-message">Error: ${message.message} (Line: ${message.line}, Column: ${message.column})</span><br>`;
                });
            } else {
                // Execute code if no errors
                try {
                    console.log = customLog;
                    eval(code);
                    console.log = originalConsoleLog;
                } catch (error) {
                    const timestamp = getTimestamp();
                    outputDiv.innerHTML += `<span class="timestamp">${timestamp}</span><span class="error-message">Error: ${error.message}</span><br>`;
                }
            }
        });
    </script>
</body>
</html>

    <style>
        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 60px);
            overflow: hidden;
            background-color: #1b2a32;
            flex-direction: row;
        }

        .clr-vertical-nav {
            width: 200px;
            background-color: #1b2a32;
            border-right: 1px solid #324f61;
            overflow-y: auto;
            height: 100%;
            flex-shrink: 0;
            padding: 0.5rem 0;
        }

        .editor-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 20px;
        }

        #container {
            flex: 1;
            border: 1px solid #324f61;
            margin-bottom: 10px;
            background-color: #1b2a32;
        }

        #output {
            height: 30vh;
            border: 1px solid #324f61;
            padding: 10px;
            background-color: #0f171c;
            color: #49afd9;
            overflow: auto;
            font-family: Consolas, Monaco, 'Courier New', monospace;
            font-size: 14px;
        }

        .nav-group-text {
            color: #e9ecef;
            font-weight: 500;
        }

        .nav-link {
            color: #c6cdd4;
            padding: 8px 12px;
            display: block;
            text-decoration: none;
            transition: background-color 0.2s ease;
        }

        .nav-link:hover {
            background-color: #324f61;
            color: #49afd9;
        }

        .nav-group-children {
            padding: 0;
        }

        .nav-group-trigger {
            width: 100%;
            padding: 12px;
            text-align: left;
            background: none;
            border: none;
            border-bottom: 1px solid #324f61;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #e9ecef;
        }

        .editor-toolbar {
            display: flex;
            align-items: center;
            margin-bottom: 0;
        }
        .code-tab {
            border: none;
            border-radius: 3px 3px 0 0;
            padding: 10px 32px;
            font-size: 16px;
            color: #e9ecef;
            position: relative;
            cursor: pointer;
            outline: none !important;
            box-shadow: none !important;
            margin-right: 8px;
            background: #1b2a32;
        }
        .code-tab.active {
            background: #1b2a32;
            color: #e9ecef;
        }
        .code-tab.active::after {
            content: '';
            display: block;
            height: 4px;
            background: #49afd9;
            position: absolute;
            left: 0;
            right: 0;
            bottom: -1px;
            border-radius: 0 0 3px 3px;
        }
        .code-tab:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        button.code-tab,
        button.code-tab:focus,
        button.code-tab:active,
        button.code-tab:focus-visible {
            outline: none !important;
            box-shadow: none !important;
        }
        button.code-tab::-moz-focus-inner {
            border: 0 !important;
        }
    </style>
